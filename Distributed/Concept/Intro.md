## 模型
### 节点
在具体的工程项目中，一个节点往往是一个操作系统上的进程。\
节点是一个完整的、不可分的整体，如果某个程序进程实际上由若干相对独立部分构成，则在模型中可以将一个进程划分为多个节点。
### 异常
1. 机器宕机：最常见的异常之一，在大型集群中每日宕机发生的概率为千分之一左右，在实践中，一台宕机的机器恢复的时间通常认为是 24 小时，一般需要人工介入重启机器。
2. 网络异常\
（1）消息丢失：两个节点之间彼此无法通信\
（2）消息乱序：有一定的概率不是按照发送时的顺序依次到达目的节点，考虑使用序列号等机制处理网络消息的乱序问题，使得无效的、过期的网络消息不影响系统的正确性\
（3）数据错误：在分布式系统的协议设计中不能认为基于 TCP 协议通信就是可靠的。其只能保证同一个 TCP 链接内的网络消息不乱序，链接之间的网络消息顺序则无法保证。
3. 分布式三态\
如果某个节点向另一个节点发起 RPC（Remote procedure call）调用，即某个节点 A 向另一个节点 B 发送一个消息，节点 B 根据收到的消息内容完成某些操作，并将操作的结果通过另一个消息返回给节点 A，那么这个 RPC 执行的结果有三种状态：“成功”、“失败”、“超时（未知）”，称之为分布式系统的三态。
4. 存储数据丢失\
对于有状态节点来说，数据丢失意味着状态丢失，通常只能从其他节点读取、恢复存储的状态。
5. 异常处理原则\
任何在设计阶段考虑到的异常情况一定会在系统实际运行中发生，但在系统实际运行遇到的异常却很有可能在设计时未能考虑，所以，除非需求指标允许，在系统设计时不能放过任何异常情况。

## 副本
在分布式系统中为数据或服务提供的冗余。对于数据，副本指在不同的节点上持久化同一份数据，当出现某一个节点的存储的数据丢失时，可以从副本上读到数据。数据副本是分布式系统解决数据丢失异常的唯一手段。\
另一类副本是服务副本，指数个节点提供某种相同的服务，这种服务一般并不依赖于节点的本地存储，其所需数据一般来自其他节点。
### 副本一致性
分布式系统通过副本控制协议，使得从系统外部读取系统内部各个副本的数据在一定的约束条件下相同，称之为副本一致性(consistency)。副本一致性是针对分布式系统而言的，不是针对某一个副本而言。
1. 强一致性(strong consistency)：任何时刻任何用户或节点都可以读到最近一次成功更新的副本数据。是程度最高的一致性要求，也是实践中最难以实现的一致性。
2. 单调一致性(monotonic consistency)：任何时刻，任何用户一旦读到某个数据在某次更新后的值，这个用户不会再读到比这个值更旧的值。是弱于强一致性却非常实用的一致性级别。因为通常来说，用户只关心从己方视角观察到的一致性，而不会关注其他用户情况。
3. 会话一致性(session consistency)：任何用户在某一次会话内一旦读到某个数据在某次更新后的值，这个用户在这次会话过程中不会再读到比这个值更旧的值。通过引入会话的概念，在单调一致性的基础上进一步放松约束，会话一致性只保证单个用户单次会话内数据的单调修改，对于不同用户间的一致性和同一用户不同会话间的一致性没有保障。实践中有许多机制正好对应会话的概念，例如 php 中的 session 概念。
4. 最终一致性(eventual consistency)：最终一致性要求一旦更新成功，各个副本上的数据最终将达到完全一致的状态，但达到完全一致状态所需要的时间不能保障。对于最终一致性系统而言，一个用户只要始终读取某一个副本的数据，则可以实现类似单调一致性的效果，但一旦用户更换读取的副本，则无法保障任何一致性。
5. 弱一致性(week consistency)：一旦某个更新成功，用户无法在一个确定时间内读到这次更新的值，且即使在某个副本上读到了新的值，也不能保证在其他副本上可以读到新的值。弱一致性系统一般很难在实际中使用，使用弱一致性系统需要应用方做更多的工作从而使得系统可用。

## 衡量指标
1. 性能\
（1）系统的吞吐能力，指系统在某一时间可以处理的数据总量，通常可以用系统每秒处理的总的数据量来衡量。\
（2）系统的响应延迟，指系统完成某一功能需要使用的时间。\
（3）系统的并发能力，指系统可以同时完成某一功能的能力，通常也用 QPS(query per second) 来衡量。\
上述三个性能指标往往会相互制约，追求高吞吐的系统，往往很难做到低延迟；系统平均响应时间较长时，也很难提高 QPS。
1. 可用性 (availability)：指系统在面对各种异常时可以正确提供服务的能力。可以用系统停服务的时间与正常服务的时间的比例来衡量，也可以用某功能的失败次数与成功次数的比例来衡量。可用性是分布式的重要指标，衡量了系统的鲁棒性，是系统容错能力的体现。
2. 可扩展性 (scalability)：指分布式系统通过扩展集群机器规模提高系统性能（吞吐、延迟、并发）、存储容量、计算能力的特性。好的分布式系统总在追求“线性扩展性”，也就是使得系统的某一指标可以随着集群中的机器数量线性增长。
3. 一致性（Consistency）：分布式系统为了提高可用性，总是不可避免的使用副本的机制，一致性即数据在多个副本之间能够保持一致的特性。
4. 分区容错性（Partition tolerance）：系统在遇到任何网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务。