先做这样的约定：更新操作（write）是一系列顺序的过程，通过其他机制确定顺序（例如 primary-secondary 架构中由 primary 决定），每个更新操作记为 wi， i 为更新操作单调递增的序号，每个 wi 执行成功后副本数据都发生变化，称为不同的数据版本，记作 vi。假设每个副本都保存了历史上所有版本的数据。
### write-all-read-one
1. 最简单的副本控制规则，即更新时写所有的副本，在所有的副本上更新成功才认为更新成功，从而保证所有的副本一致，这样读取数据时可以读任一副本。
2. 对于更新服务，虽然有 N 个副本， 但系统无法容忍任何一个副本异常。对于读服务，系统可以容忍 N-1 个副本异常。从上述分析可以发现 WARO 读服务的可用性较高，但更新服务的可用性不高。
### Quorum 定义
1. 当某次更新操作 wi 在所有 N 个副本中的 W 个都成功，则称为“成功提交的更新操作”，称对应的数据为“成功提交的数据”。令 R>N-W，最多读取 R 个副本一定能读到更新后的数据 vi。
2. 令 W=N，R=1，就得到 WARO，即 WARO 是 Quorum 机制的一种特例。
3. 限制 Quorum 参数为 W+R=N+1。由于更新操作需要在 W 个副本上都成功，所以一旦 N-W+1 个副本异常，更新操作始终无法在 W 个副本上成功，更新服务不可用。同时无法保证一定读到与 W 个副本有交集的副本集合，读服务一致性下降。
4. 仅依赖quorum 机制无法保证强一致性的。因为无法确定最新成功提交的版本号，除非将其作为元数据管理，否则很难确定最新版本号。
5. Quorum 机制的三个系统参数 N、W、R（一般W+R=N+1）控制了系统的可用性，也是系统对用户的服务承诺：最多有 N 个副本，但数据更新成功 W 个副本即返回用户成功。对于一致性要求较高的 Quorum 系统，还应承诺任何时候不读取未成功提交的数据，即读取到的数据都是曾经在 W 个副本上成功的数据。
### 读取最新成功提交数据
1. 由于更新可能不成功，仅读取 R 个副本不一定能确定哪个版本的数据是最新提交的。
2. 对于一个强一致性 Quorum 系统，读取 R 个副本后，若最高版本数据副本少于 W 个，则继续读取其他副本，直到成功读取到 W 个，则该数据为最新的成功提交的数据；如果在所有副本中不足 W 个，则 R 中版本号第二大的为最新的成功提交的副本。\
例：假设 N=5, W=3, R=3，在读取到（v2 v1 v1）时，继续读取剩余的副本，若读到剩余两个副本 为（v2 v2）则 v2 是最新的已提交的副本；若读到剩余的两个副本为（v2 v1）或（v1 v1）则 v1 是最新成功提交的版本；若读取后续两个副本有任一超时或失败，则无法判断哪个版本是最新的成功提交的版本。
3. 单纯使用 Quorum 机制时，若要确定最新的成功提交的版本，最多需要读取 N 个副本，当出现任一副本异常时，读最新成功提交的版本这一功能可能不可用。实际工程中，应该尽量结合其他技术手段。例如，当 quorum 机制与 primary-secondary 控制协议结合使用时，可以通过读取 primary 的方式读取到最新已提交的数据。
### 选择 primary 副本
1. 读取数据时不同一致性要求的做法可以不同：如果需要强一致性的立刻读取到最新成功提交数据，可以只读取 primary 副本；如果需要会话一致性，可以根据之前已经读到的数据版本号在各个副本上进行选择性读取；如果需要弱一致性，可以读取任意副本。
2. 在 primary-secondary 协议中，当 primary 异常时，需要选择出一个新的 primary，之后 secondary 副本与 primary 同步数据。通常情况下，选择新的 primary 的工作是由某一中心节点完成的。引入 quorum 机制后，常用的 primary 选择方式与读取数据的方式类似，即中心节点读取 R 个副本，选择 R 个副本中版本号最高的副本作为新的 primary。新 primary 与至少 W 个副本完成数据同步后作为新的 primary 提供读写服务。
3. 首先，R 个副本中版本号最高的副本一定有最新成功提交的数据。再者，虽然不能确定最高版本号的数是一个成功提交的数据，但新的 primary 在随后与 secondary 同步数据，使得该版本的副本个数达到 W，从而使得该版本的数据成为成功提交的数据。
4. 例：在 N=5，W=3，R=3 的系统中，某时刻副本版本号为（v2 v2 v1 v1 v1），v1 是最新成功提交的数据，v2 是处于中间状态未成功提交的数据。假设此刻中心节点进行 primary 切换工作。这类数据是作为“脏数据”被删除，还是作为新的数据被同步后成为生效的数据，完全取决于这个数据能否参与新 primary 的选举。下面分析这两种情况。
5. 第一，若中心节点读取到的版本号为（v1 v1 v1），则选取 v1 副本作为新的 primary，当与第 1、第 2 个副本同步数据时，由于其余俩副本版本号大于 primary，属于脏数据丢弃。实践中，新 primary 也有可能与后两个副本完成同步后就提供数据服务，随后自身版本号也更新到 v2，如果系统不能保证之后的 v2 与之前的 v2 完全一样，则新 primary 在与其余俩副本同步数据时不但要比较数据版本号还需要比较更新操作的具体内容是否一样。
7. 第二，若中心节点读取到的版本号为（v2 v1 v1），则选取 v2 副本作为新的 primary，之后，一旦新 primary 与其他 2 个副本完成数据同步，则符合 v2 的副本个数达到 W 个，成为最新的成功提交的副本。