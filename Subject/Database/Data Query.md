# 数据查询流程（pending）
<img src="../../Pic/Subject/Database/database-data-query-process.png" style="width:400px;padding:10px;"/>

# 客户端管理器
客户端管理器通过一系列知名的API（JDBC, ODBC, OLE-DB …）提供不同的方式来访问数据库。当连接到数据库时，管理器有以下流程。
1. 检查验证信息（用户名和密码），然后检查是否有访问授权。这些权限由DBA(Database Administrator，数据库管理员)分配。
2. 检查是否有空闲进程（或线程）来处理查询，以及数据库负载。
3. 可能会等待来获取需要的资源，如果等待时间达到超时时间，管理器会关闭连接并给出错误信息。
4. 把查询送给查询管理器来处理。
# 查询管理器
1. 查询首先被解析并判断是否合法。
2. 重写查询指令，去除了无用的操作并且加入预优化部分。
3. 优化以便提升性能，并被转换为可执行代码和数据访问计划。
4. 计划被编译，并执行。
## 查询解析器
1. 检查关键字拼写和使用顺序是否正确
2. 分析查询中的表和字段，使用数据库元数据来检查：\
（1）表是否存在\
（2）表的字段是否存在\
（3）对某类型字段的运算“是否”可能（如不能将整数和字符串进行比较）
3. 检查在查询中是否有权限来读取（或写入）表
4. 解析过程中，SQL 查询被转换为内部表示（通常是一个树）。如果一切正常，内部表示被送到查询重写器。
## 查询重写器
按照一系列规则对查询执行检测，如果查询匹配一种规则，按此规则重写查询。以下是一些规则
1. 视图合并：使用视图，视图就会转换为它的 SQL 代码。
2. 去除不必要的运算符：如使用 DISTINCT 关键字，而其实表中有 UNIQUE 约束，则去除DISTINCT。
3. 排除冗余的联接：如果相同的 JOIN 条件出现两次，比如隐藏在视图中的 JOIN 条件，或者由于传递性产生的无用 JOIN，都会被消除。
4. 常数计算赋值：如 WHERE AGE > 10+2 会转换为 WHERE AGE > 12 ， TODATE(“日期字符串”) 会转换为 datetime 格式的日期值。
5. 物化视图重写（Materialized view rewrite）：如果有个物化视图匹配查询谓词的一个子集，重写器将检查视图是否最新并修改查询，令查询使用物化视图而不是原始表。
6. 分区裁剪（Partition Pruning）：如果用了分区表，重写器能够找到需要使用的分区。
## 查询优化器

## 查询计划缓存
1. 创建查询计划是耗时的，大多数据库把计划保存在查询计划缓存，来避免重复计算。
2. 设置一个上限，如果一个表的统计变化超过了上限，关于该表的查询计划就从缓存中清除。
## 查询执行器
1. 将优化过的执行计划编译为可执行代码，如果有足够资源（内存，CPU），查询执行器就会执行它。
2. 为了获得和写入数据，查询执行器与数据管理器交互。

# 数据管理器（含复原管理器）
存在两个问题：\
（1）关系型数据库使用事务模型，当其他人在同一时刻使用或修改数据时，无法得到这部分数据。\
（2）数据提取是数据库中速度最慢的操作，所以数据管理器需要足够聪明地获得数据并保存在内存缓冲区内。
## 缓存管理器

## 事务管理器

## 锁管理器

## 日志管理器

