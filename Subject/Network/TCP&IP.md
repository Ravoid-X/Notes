## 结构
<img src="../../Pic/Subject/Network/tcpip-structure.jpg" style="width:400px;padding:10px;"/>

## 链路层
处理连接网络的硬件部分。该层既包括操作系统硬件的设备驱动、NIC（网卡）、光纤等物理可见部分，还包括连接器等一切传输媒介。在这一层，数据的传输单位为比特。其主要协议有ARP、RARP等。
### 集线器
1. 多台主机和设备的连接器，把一个端口接收的所有信号向所有端口分发出去。
2. 一些集线器在分发之前将弱信号重新生成，一些集线器整理信号的时序以提供所有端口间的同步数据通信。\
<img src="../../Pic/Subject/Network/tcpip-hub.png" style="width:400px;padding:10px;"/>

3. MAC（Media Access Control）地址：网络中每台设备都有的唯一的网络标识，长度为 48 位，是由网络设备制造商生产时烧录在网卡的 EPROM。\
（1）前 24 位（00-16-EA）代表网络硬件制造商的编号\
（2）后 24 位（AE-3C-40）是该厂家自己分配的，一般表示系列号
4. A 在发送数据包时，在头部添加地址，B 在收到数据包后，根据头部的目标 MAC 地址信息，判断这个数据包的确是发给自己的，于是便收下，否则丢弃\
<img src="../../Pic/Subject/Network/tcpip-mac.png" style="width:400px;padding:10px;"/>

### 交换机
集线器会将消息广播给所有主机，不安全且浪费网络资源，引入交换机，只向目标 MAC 地址指向的那台电脑发送消息\
<img src="../../Pic/Subject/Network/tcpip-switch.png" style="width:400px;padding:10px;"/>

1. 交换机内部维护一张 MAC 地址表，记录着每一个 MAC 地址的设备连接在哪一个端口上。
2. 消息到达交换机时，通过自维护的 MAC 地址表，得到目标机器的 MAC 地址映射的端口号，直接将消息发送到对应端口
3. 通过这样传输方式而组成的小范围的网络，叫做以太网
4. 最开始的时候，MAC 地址表是空的，若 MAC 地址无对应端口，则将数据包发给所有端口，根据响应更新地址表

### 二层交换机
随着机器数量越多，交换机的端口也不够了，此时可将多个交换机连接起来\
<img src="../../Pic/Subject/Network/tcpip-switch-net.png" style="width:400px;padding:10px;"/>

EFGH在左边交换机中为同一个端口号

## 网络层
1. 负责将数据传输到目标地址，目标地址可以是多个网络通过路由器连接而成的某一个地址。
2. 另外负责寻找合适的路径到达对方计算机，并把数据帧传送给对方，还可以实现拥塞控制、网际互连等功能。
3. 网络层协议的代表包括：ICMP、IP、IGMP等。
### 路由器
1. 电脑的数量发展到成千上万时，交换机已经无法记录如此庞大的映射关系。
2. 问题在于连出去的红色网线，后面不知道有多少设备不断连接，使得地址表越来越大。
3. 红色的网线接入一个新的设备，有自己独立的 MAC 地址，同时能把数据包做一次转发，即为路由器。
4. 路由器的每一个端口都有独立的 MAC 地址，交换机的 MAC 地址表中，只需要多出一条地址与其端口的映射关系，就可以成功把数据包转交给路由器了。\
<img src="../../Pic/Subject/Network/tcpip-router.png" style="width:400px;padding:10px;"/>

5. 使用计算机在网络中进行通信时，每个计算机都需要一个唯一的标识符，这个标识符就是 IP 地址，其可以随时修改。

### 路由器工作流程
1. 先给每一台设备加上 IP 地址，数据包除了加上数据链路层的 MAC 地址头部外，还要增加网络层的 IP 地址头部\
<img src="../../Pic/Subject/Network/tcpip-router-message.png" style="width:400px;padding:10px;"/>

2. 假设网络如下\
<img src="../../Pic/Subject/Network/tcpip-router-address.png" style="width:400px;padding:10px;"/>

3. 假如 A 给 C 发送数据，A 就需要先转交给路由器，然后再由路由器转交给 C。由于最底层的传输仍然需要依赖以太网，所以数据包是分成两段的
4. A ~ 路由器的包如下\
<img src="../../Pic/Subject/Network/tcpip-router-address1.png" style="width:400px;padding:10px;"/>

5. 路由器到 C 的包如下\
<img src="../../Pic/Subject/Network/tcpip-router-address2.png" style="width:400px;padding:10px;"/>

6. A 给 C 发数据包，怎么知道是否要通过路由器转发，需要通过子网。
7. 如果源 IP 与目的 IP 处于一个子网，直接将包通过交换机发出去；如果不处于一个子网，就交给路由器去处理。
8. A 如何知道，哪个设备是路由器？在 A 上要设置默认网关。
### 默认网关
1. 当主机或需要与其他网络中的设备进行通信时，它会将数据包发送到默认网关，由默认网关负责将数据包转发到目标网络。
2. 默认网关的设置通常在网络设备的配置过程中完成。在大多数家庭和小型办公网络中，路由器通常被设置为默认网关。
### 路由表
1. 路由器如何知道 C 在哪里？路由表。
### ARP
1. 发送数据包的数据链路层需要知道 MAC 地址，目前只有 IP 地址。
2. ARP 协议解决的是 IP 地址和 MAC 地址之间的转换问题

## 传输层
1. 为端到端连接提供传输服务；
2. 这种传输服务分为可靠和不可靠的，其中 TCP 是典型的可靠传输，而 UDP 则是不可靠传输；
3. 为端到端连接提供流量控制、差错控制、QoS(Quality of Service)服务质量等管理服务。
4. 传输层主要有两个性质不同的协议：
### TCP 
1. 是一个面向连接的、可靠的传输协议，提供一种可靠的字节流，能保证数据完整、无损并且按顺序到达。
2. TCP 尽量连续不断地测试网络的负载并且控制发送数据的速度以避免网络过载。
3. 另外，TCP 试图将数据按照规定的顺序发送。
### UDP
1. 是一个无连接的数据报协议，是一个“尽力传递”和“不可靠”协议。
2. 不会对数据包是否已经到达目的地进行检查，并且不保证数据包按顺序到达。

## 应用层
1. 包括所有和应用程序协同工作，并利用基础网络交换应用程序的业务数据的协议。
2. 一些特定的程序被认为运行在这个层上，该层协议所提供的服务能直接支持用户应用。
3. 包括HTTP（万维网服务）、FTP（文件传输）、SMTP（电子邮件）、SSH（安全远程登陆）、DNS（域名解析）以及许多其他协议。